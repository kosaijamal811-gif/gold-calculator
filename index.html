<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --gold: #FFD700; --silver: #E2E2E2; --bg: #000; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #000; color: white; display: flex; justify-content: center; padding: 10px; }
        .unified-card { width: 100%; max-width: 380px; background: var(--bg); border: 2px solid #222; border-radius: 20px; padding: 20px; text-align: center; }
        .market-display { background: #111; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #333; display: flex; flex-direction: column; gap: 8px; }
        .live-row { display: flex; justify-content: space-between; align-items: center; }
        .live-label { font-size: 11px; font-weight: 800; color: #555; text-transform: uppercase; }
        .live-price { font-size: 24px; font-weight: 900; color: var(--gold); font-family: monospace; }
        .btn-box { display: flex; gap: 8px; margin-bottom: 20px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-size: 14px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .g-on { background: var(--gold); color: black; }
        .s-on { background: var(--silver); color: black; }
        .off { background: #1a1a1a; color: white; }
        input { width: 100%; background: transparent; border: none; border-bottom: 3px solid var(--gold); color: white; font-size: 45px; font-weight: 900; text-align: center; outline: none; margin-bottom: 20px; }
        .selectors { display: flex; gap: 8px; margin-bottom: 20px; }
        select { flex: 1; background: #000; color: white; border: 1px solid #333; padding: 12px; border-radius: 10px; font-size: 13px; font-weight: bold; cursor: pointer; }
        .total-box { padding: 10px; border-top: 1px solid #222; margin-top: 10px; }
        .final-val { font-size: 48px; font-weight: 900; color: var(--gold); letter-spacing: -1px; }
        .status { color: #00FF88; font-size: 10px; font-weight: bold; margin-top: 10px; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body>
<div class="unified-card">
    <div class="market-display">
        <div class="live-row">
            <span class="live-label">Gold Price (Spot)</span>
            <span id="goldSpot" class="live-price">$Fetching...</span>
        </div>
        <div class="live-row">
            <span class="live-label">Silver Price (Spot)</span>
            <span id="silverSpot" class="live-price" style="color:var(--silver)">$Fetching...</span>
        </div>
    </div>
    <div class="btn-box">
        <button id="gB" class="btn g-on" onclick="setM('G')">GOLD (AU)</button>
        <button id="sB" class="btn off" onclick="setM('S')">SILVER (AG)</button>
    </div>
    <input type="number" id="amt" value="1" oninput="recalc()">
    <div class="selectors">
        <select id="unt" onchange="recalc()"><option value="OZ">Ounce</option><option value="GR">Gram</option></select>
        <select id="krt" onchange="recalc()"><option value="24">24 Karat</option><option value="21">21 Karat</option><option value="18">18 Karat</option></select>
    </div>
    <div class="total-box">
        <div id="res" class="final-val">--</div>
        <div style="font-size: 10px; color: #555; font-weight: bold; margin-top: 5px;">ESTIMATED TOTAL VALUE (USD)</div>
        <div class="status">● LIVE MARKET SYNC ACTIVE [2026]</div>
    </div>
</div>
<script>
    let rates = { gold: 4817.75, silver: 93.15 }; 
    let mode = 'G';
    async function fetchLive() {
        try {
            const r = await fetch('https://api.exchangerate-api.com/v4/latest/XAU');
            const d = await r.json();
            if(d && d.rates && d.rates.USD) {
                rates.gold = d.rates.USD;
                const sr = await fetch('https://api.exchangerate-api.com/v4/latest/XAG');
                const sd = await sr.json();
                rates.silver = sd.rates.USD;
                document.getElementById('goldSpot').innerText = '$' + rates.gold.toLocaleString('en-US', {minimumFractionDigits: 2});
                document.getElementById('silverSpot').innerText = '$' + rates.silver.toLocaleString('en-US', {minimumFractionDigits: 2});
            }
            recalc();
        } catch (e) { recalc(); }
    }
    function setM(m) {
        mode = m;
        document.getElementById('gB').className = m === 'G' ? 'btn g-on' : 'btn off';
        document.getElementById('sB').className = m === 'S' ? 'btn s-on' : 'btn off';
        document.getElementById('krt').style.display = m === 'G' ? 'block' : 'none';
        recalc();
    }
    function recalc() {
        const q = document.getElementById('amt').value || 0;
        const u = document.getElementById('unt').value;
        const k = document.getElementById('krt').value;
        const out = document.getElementById('res');
        let spot = mode === 'G' ? rates.gold : rates.silver;
        let p = 0;
        if (mode === 'G') {
            let g24 = spot / 31.1035;
            let r = k == "24" ? 1 : k == "21" ? 0.875 : 0.75;
            p = (u === 'OZ' && k == "24") ? spot : (g24 * r);
            if(u === 'OZ' && k != "24") p = (g24 * r) * 31.1035;
        } else {
            p = u === 'OZ' ? spot : (spot / 31.1035);
        }
        out.innerText = '$' + (q * p).toLocaleString('en-US', {minimumFractionDigits: 2});
        out.style.color = mode === 'G' ? '#FFD700' : '#E2E2E2';
    }
    setInterval(fetchLive, 30000);
    fetchLive();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: #000; color: white; font-family: sans-serif; display: flex; justify-content: center; padding: 20px; }
        .box { width: 100%; max-width: 400px; background: #0a0a0a; border-radius: 15px; border: 1px solid #333; padding: 15px; text-align: center; }
        /* أداة البث المباشر */
        .live-price-container { height: 130px; margin-bottom: 15px; border-radius: 10px; overflow: hidden; }
        .input-area { margin: 15px 0; }
        input, select { width: 90%; padding: 12px; margin: 5px; border-radius: 8px; border: 1px solid #444; background: #111; color: #ffd700; font-size: 18px; text-align: center; }
        .res-title { color: #888; font-size: 12px; margin-top: 10px; }
        #total { font-size: 35px; color: #ffd700; font-weight: bold; font-family: monospace; margin: 10px 0; }
        .aed-val { color: #00ff88; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <div style="color: #00ff88; font-size: 11px; margin-bottom: 10px;">● بث حي مباشر من البورصة العالمية</div>
    
    <div class="live-price-container">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
            {
              "symbol": "TVC:GOLD",
              "width": "100%", "height": "100%", "locale": "ar",
              "dateRange": "1D", "colorTheme": "dark", "isTransparent": true,
              "autosize": true, "largeChartUrl": ""
            }
            </script>
        </div>
    </div>

    <div class="input-area">
        <input type="number" id="amt" value="1" oninput="calc()">
        <select id="type" onchange="calc()">
            <option value="24">ذهب عيار 24 (جرام)</option>
            <option value="21">ذهب عيار 21 (جرام)</option>
            <option value="18">ذهب عيار 18 (جرام)</option>
            <option value="oz">أونصة ذهب (OZ)</option>
        </select>
    </div>

    <div class="res-title">القيمة الإجمالية التقريبية</div>
    <div id="total">$0.00</div>
    <div class="aed-val" id="aed">0.00 AED</div>
</div>

<script>
    let currentGoldPrice = 0;

    // وظيفة لجلب السعر بشكل متكرر وسريع جداً
    async function getLive() {
        try {
            const r = await fetch('https://api.exchangerate-api.com/v4/latest/XAU');
            const d = await r.json();
            currentGoldPrice = d.rates.USD;
            calc();
        } catch(e) {}
    }

    function calc() {
        let amt = document.getElementById('amt').value;
        let type = document.getElementById('type').value;
        let price = 0;

        if(type === "oz") {
            price = currentGoldPrice;
        } else {
            let gram24 = currentGoldPrice / 31.1035;
            if(type === "24") price = gram24;
            if(type === "21") price = gram24 * 0.875;
            if(type === "18") price = gram24 * 0.75;
        }

        let totalUSD = amt * price;
        let totalAED = totalUSD * 3.67; // التحويل للدرهم الإماراتي

        document.getElementById('total').innerText = '$' + totalUSD.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('aed').innerText = totalAED.toLocaleString(undefined, {minimumFractionDigits: 2}) + " AED";
    }

    // تحديث السعر كل 5 ثوانٍ لضمان الحركة
    setInterval(getLive, 5000);
    getLive();
</script>

</body>
</html>
