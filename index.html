<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: #000; color: white; font-family: sans-serif; display: flex; justify-content: center; padding: 20px; }
        .box { width: 100%; max-width: 400px; background: #0a0a0a; border-radius: 15px; border: 1px solid #333; padding: 15px; text-align: center; }
        /* أداة البث المباشر */
        .live-price-container { height: 130px; margin-bottom: 15px; border-radius: 10px; overflow: hidden; }
        .input-area { margin: 15px 0; }
        input, select { width: 90%; padding: 12px; margin: 5px; border-radius: 8px; border: 1px solid #444; background: #111; color: #ffd700; font-size: 18px; text-align: center; }
        .res-title { color: #888; font-size: 12px; margin-top: 10px; }
        #total { font-size: 35px; color: #ffd700; font-weight: bold; font-family: monospace; margin: 10px 0; }
        .aed-val { color: #00ff88; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <div style="color: #00ff88; font-size: 11px; margin-bottom: 10px;">● بث حي مباشر من البورصة العالمية</div>
    
    <div class="live-price-container">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
            {
              "symbol": "TVC:GOLD",
              "width": "100%", "height": "100%", "locale": "ar",
              "dateRange": "1D", "colorTheme": "dark", "isTransparent": true,
              "autosize": true, "largeChartUrl": ""
            }
            </script>
        </div>
    </div>

    <div class="input-area">
        <input type="number" id="amt" value="1" oninput="calc()">
        <select id="type" onchange="calc()">
            <option value="24">ذهب عيار 24 (جرام)</option>
            <option value="21">ذهب عيار 21 (جرام)</option>
            <option value="18">ذهب عيار 18 (جرام)</option>
            <option value="oz">أونصة ذهب (OZ)</option>
        </select>
    </div>

    <div class="res-title">القيمة الإجمالية التقريبية</div>
    <div id="total">$0.00</div>
    <div class="aed-val" id="aed">0.00 AED</div>
</div>

<script>
    let currentGoldPrice = 0;

    // وظيفة لجلب السعر بشكل متكرر وسريع جداً
    async function getLive() {
        try {
            const r = await fetch('https://api.exchangerate-api.com/v4/latest/XAU');
            const d = await r.json();
            currentGoldPrice = d.rates.USD;
            calc();
        } catch(e) {}
    }

    function calc() {
        let amt = document.getElementById('amt').value;
        let type = document.getElementById('type').value;
        let price = 0;

        if(type === "oz") {
            price = currentGoldPrice;
        } else {
            let gram24 = currentGoldPrice / 31.1035;
            if(type === "24") price = gram24;
            if(type === "21") price = gram24 * 0.875;
            if(type === "18") price = gram24 * 0.75;
        }

        let totalUSD = amt * price;
        let totalAED = totalUSD * 3.67; // التحويل للدرهم الإماراتي

        document.getElementById('total').innerText = '$' + totalUSD.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('aed').innerText = totalAED.toLocaleString(undefined, {minimumFractionDigits: 2}) + " AED";
    }

    // تحديث السعر كل 5 ثوانٍ لضمان الحركة
    setInterval(getLive, 5000);
    getLive();
</script>

</body>
</html>
